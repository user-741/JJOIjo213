<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Test 2 Pro ‚Äî Interactive Study Suite</title>
<style>
:root{--bg:#0e1117;--panel:#0f172a;--glass:rgba(255,255,255,.04);--text:#e6edf3;--muted:#a7b4c8;--accent:#6ee7ff;--accent2:#a78bfa;--ok:#4ade80;--warn:#fbbf24;--err:#f87171;--border:#1e293b;--chip:#111827;--code:#0b1220;--gold:#ffd166}
[data-theme=light]{--bg:#f7f9fc;--panel:#fff;--glass:rgba(16,24,40,.06);--text:#0b1220;--muted:#596780;--accent:#2563eb;--accent2:#7c3aed;--ok:#16a34a;--warn:#b45309;--err:#dc2626;--border:#e5e7eb;--chip:#eef2ff;--code:#0f172a;--gold:#b45309}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 600px at 20% -10%, rgba(167,139,250,.15), transparent 60%),radial-gradient(900px 500px at 120% 10%, rgba(110,231,255,.12), transparent 60%),linear-gradient(180deg,var(--bg),var(--bg));color:var(--text);font:16px/1.6 Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
.app{display:grid;grid-template-columns:280px 1fr;min-height:100vh}
.sidebar{position:sticky;top:0;align-self:start;height:100vh;overflow:auto;background:linear-gradient(180deg,var(--panel),rgba(0,0,0,0));border-right:1px solid var(--border);padding:18px}
.brand{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:14px}
.logo{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.4px}
.pulse{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 0 var(--accent);animation:pulse 2s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(110,231,255,.8)}70%{box-shadow:0 0 0 12px rgba(110,231,255,0)}100%{box-shadow:0 0 0 0 rgba(110,231,255,0)}}
.nav a{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;color:var(--muted);text-decoration:none;border:1px solid transparent}
.nav a:hover,.nav a.active{background:var(--glass);color:var(--text);border-color:var(--border)}
.nav .tag{margin-left:auto;font-size:12px;padding:2px 8px;border-radius:999px;background:var(--chip);color:var(--muted)}
.toolbar{display:flex;gap:8px}
.btn{border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0));color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;font-size:14px}
.btn:hover{transform:translateY(-1px);filter:brightness(1.05)}
.btn:disabled{opacity:.5;cursor:not-allowed}
.btn.ghost{background:transparent}
.btn.primary{background:linear-gradient(180deg,var(--accent),var(--accent2));color:#0b1220;border:0;font-weight:700}
.btn.success{background:var(--ok);color:#0b1220;border:0}
.btn.danger{background:var(--err);color:#fff;border:0}
.kbd{display:inline-flex;align-items:center;gap:4px;padding:2px 6px;border:1px solid var(--border);border-bottom-width:2px;border-radius:6px;background:var(--chip);color:var(--text);font-size:12px}
main{padding:24px 28px;max-width:1400px}
.hero{display:flex;align-items:center;justify-content:space-between;gap:20px;padding:18px 20px;border:1px solid var(--border);border-radius:18px;backdrop-filter:blur(8px);background:linear-gradient(180deg,var(--glass),transparent);margin-bottom:20px}
.hero h1{margin:0;font-size:24px}
.stats{display:flex;gap:18px;flex-wrap:wrap}
.stat{min-width:140px;padding:10px 12px;border:1px solid var(--border);border-radius:14px;background:var(--panel)}
.stat b{font-size:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:18px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.15)}
.card .head{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;border-bottom:1px solid var(--border)}
.card .head h3{margin:0;font-size:18px}
.card .body{padding:14px 16px}
.code{position:relative;background:var(--code);border:1px solid var(--border);border-radius:12px;padding:12px;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;font-size:14px;color:#d1e4ff;line-height:1.5}
.flex{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.muted{color:var(--muted)}
.ok{color:var(--ok)}
.warn{color:var(--warn)}
.err{color:var(--err)}
.hidden{display:none}
.terminal{background:var(--code);border:1px solid var(--border);border-radius:12px;padding:16px;font-family:ui-monospace,monospace;font-size:14px;color:#d1e4ff;min-height:200px;max-height:400px;overflow-y:auto}
.terminal-line{margin:4px 0;display:flex;gap:8px}
.terminal-prompt{color:var(--accent);font-weight:700}
.terminal-output{color:#a7b4c8}
.terminal-error{color:var(--err)}
.terminal-success{color:var(--ok)}
.scenario-box{background:var(--glass);border:2px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px}
.scenario-box h4{margin:0 0 8px 0;color:var(--accent)}
.topology{background:var(--code);border:2px dashed var(--border);border-radius:12px;padding:20px;text-align:center;min-height:180px;display:flex;align-items:center;justify-content:center;font-family:monospace;font-size:13px;line-height:1.8}
.hint-box{background:rgba(251,191,36,.1);border-left:4px solid var(--warn);padding:12px;border-radius:8px;margin:12px 0}
.progress-bar{width:100%;height:8px;background:var(--glass);border-radius:10px;overflow:hidden;margin:8px 0}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .3s ease}
.badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border:1px solid var(--border);border-radius:999px;background:var(--glass);font-size:12px;font-weight:600}
.challenge-step{background:var(--panel);border:2px solid var(--border);border-radius:12px;padding:16px;margin:12px 0;position:relative}
.challenge-step.completed{border-color:var(--ok);background:rgba(74,222,128,.05)}
.challenge-step.active{border-color:var(--accent);box-shadow:0 0 20px rgba(110,231,255,.2)}
.step-number{position:absolute;top:-12px;left:16px;background:var(--panel);padding:4px 12px;border:2px solid var(--border);border-radius:999px;font-weight:700;font-size:12px}
.command-input{width:100%;background:var(--code);color:var(--text);border:2px solid var(--border);border-radius:8px;padding:10px 12px;font-family:ui-monospace,monospace;font-size:14px;margin:8px 0}
.command-input:focus{outline:none;border-color:var(--accent)}
.validation-item{display:flex;align-items:center;gap:8px;padding:6px 10px;margin:4px 0;background:var(--glass);border-radius:6px;font-size:13px}
.tab-buttons{display:flex;gap:8px;margin-bottom:16px}
.tab-btn{padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:8px;cursor:pointer;font-size:14px;transition:all .2s}
.tab-btn.active{background:var(--accent);color:#0b1220;border-color:var(--accent)}
.exam-question{background:var(--panel);border:2px solid var(--border);border-radius:12px;padding:20px;margin:16px 0}
.exam-question h4{margin:0 0 12px 0;color:var(--accent)}
.sub-question{background:var(--glass);border-left:3px solid var(--accent2);padding:12px;margin:8px 0;border-radius:6px}
.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.95);background:var(--panel);border:2px solid var(--border);border-radius:16px;padding:24px;max-width:500px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.5);z-index:1000;opacity:0;pointer-events:none;transition:all .3s}
.popup.show{opacity:1;pointer-events:all;transform:translate(-50%,-50%) scale(1)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:999;opacity:0;pointer-events:none;transition:opacity .3s}
.overlay.show{opacity:1;pointer-events:all}
table{width:100%;border-collapse:collapse;font-size:14px}
table th{background:var(--glass);padding:12px;text-align:left;border-bottom:2px solid var(--border);font-weight:600;color:var(--accent);white-space:nowrap;position:sticky;top:0}
table td{padding:12px;border-bottom:1px solid var(--border);color:var(--text)}
table tr{transition:background .2s}
table tr:hover{background:rgba(110,231,255,.08);cursor:pointer}
table code{background:var(--code);padding:4px 8px;border-radius:4px;color:var(--accent);font-size:13px;white-space:nowrap;display:inline-block}
.practice-btn{padding:6px 12px;background:var(--accent);color:#0b1220;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:700;transition:all .2s}
.practice-btn:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(110,231,255,.4)}
.cmd-popup{max-width:700px}
.cmd-practice-area{margin-top:16px;padding:16px;background:var(--glass);border-radius:12px;border:2px solid var(--border)}
@media (max-width:1100px){.app{grid-template-columns:1fr}.sidebar{height:auto;position:static}}
</style>
</head>
<body>
<div class="app">
<aside class="sidebar">
<div class="brand">
<div class="logo"><div class="pulse"></div><span>Test 2 <span style="color:var(--gold)">Pro</span></span></div>
<button class="btn ghost" id="themeBtn" title="Toggle theme">üåì</button>
</div>
<nav class="nav">
<a href="#dash" class="active">üè† Dashboard</a>
<a href="#interactive">üéÆ Interactive Labs</a>
<a href="#scenarios">üéØ Real Scenarios</a>
<a href="#exam-sim">üìù Exam Simulator</a>
<a href="#quick-drill">‚ö° Quick Drills</a>
<a href="#commands">üßæ Command Ref</a>
<a href="#progress">üìä Progress</a>
</nav>
<div style="margin-top:14px;font-size:12px" class="muted">üí° Learn by DOING, not reading!</div>
</aside>

<main>
<section id="dash">
<div class="hero">
<div>
<h1>DO-Based Learning System</h1>
<div class="muted">Hands-on labs that mirror real exam questions</div>
</div>
<div class="stats">
<div class="stat"><div class="muted">Mastery</div><b id="masteryPct">0%</b></div>
<div class="stat"><div class="muted">Labs Done</div><b id="labsDone">0</b></div>
<div class="stat"><div class="muted">Streak</div><b id="streak">0</b></div>
</div>
</div>

<div class="grid">
<div class="card">
<div class="head"><h3>üéÆ Start Interactive Lab</h3></div>
<div class="body">
<p>Jump into hands-on scenarios where you'll configure routers step-by-step</p>
<button class="btn primary" onclick="goTo('interactive')">Start Lab ‚Üí</button>
</div>
</div>
<div class="card">
<div class="head"><h3>üéØ Real Network Scenarios</h3></div>
<div class="body">
<p>Practice with realistic network problems that match exam format</p>
<button class="btn primary" onclick="goTo('scenarios')">Start Scenario ‚Üí</button>
</div>
</div>
<div class="card">
<div class="head"><h3>üìù Exam Simulator</h3></div>
<div class="body">
<p>Full exam with 5 questions (a, b, c parts) and 45-minute timer</p>
<button class="btn primary" onclick="goTo('exam-sim')">Take Exam ‚Üí</button>
</div>
</div>
</div>
</section>

<section id="interactive" class="hidden">
<h2>üéÆ Interactive Configuration Lab</h2>
<div class="card">
<div class="head">
<h3 id="lab-title">Loading...</h3>
<div class="flex">
<span class="badge">Step <b id="step-counter">1/5</b></span>
<button class="btn" id="hint-btn">üí° Hint</button>
<button class="btn" id="solution-btn">üìñ Show Solution</button>
<button class="btn primary" id="next-lab-btn">Next Lab</button>
</div>
</div>
<div class="body">
<div class="scenario-box" id="scenario-desc"></div>
<div class="topology" id="topology-view"></div>
<div id="steps-container"></div>
<div id="terminal-container" class="terminal hidden"></div>
<div class="progress-bar"><div class="progress-fill" id="lab-progress"></div></div>
</div>
</div>
</section>

<section id="scenarios" class="hidden">
<h2>üéØ Real Network Scenarios</h2>
<div class="tab-buttons">
<button class="tab-btn active" data-topic="nat">NAT</button>
<button class="tab-btn" data-topic="tunnel">GRE Tunnel</button>
<button class="tab-btn" data-topic="dv">Distance Vector</button>
<button class="tab-btn" data-topic="frame">Frame Relay</button>
<button class="tab-btn" data-topic="ipv6">IPv6 OSPF</button>
</div>
<div id="scenario-content"></div>
</section>

<section id="exam-sim" class="hidden">
<h2>üìù Full Exam Simulation (45 Minutes)</h2>
<div class="card">
<div class="head">
<h3>Test 2 - Exam</h3>
<div class="flex">
<span class="badge" id="exam-timer">45:00</span>
<button class="btn primary" id="start-exam-btn">Begin Exam</button>
<button class="btn danger" id="submit-exam-btn" disabled>Submit</button>
</div>
</div>
<div class="body" id="exam-container">
<p class="muted">Click "Begin Exam" to start the 45-minute timer</p>
</div>
</div>
</section>

<section id="quick-drill" class="hidden">
<h2>‚ö° Quick Command Drills</h2>
<div class="card">
<div class="head">
<h3>Rapid Fire Challenge</h3>
<div class="flex">
<span class="badge">Score: <b id="drill-score">0/0</b></span>
<span class="badge">Timer: <b id="drill-timer">00:00</b></span>
<button class="btn primary" id="start-drill-btn">Start</button>
</div>
</div>
<div class="body">
<div id="drill-question" class="scenario-box hidden"></div>
<input type="text" class="command-input" id="drill-input" placeholder="Type command and press Enter...">
<div id="drill-feedback" class="muted"></div>
<div id="drill-history"></div>
</div>
</div>
</section>

<section id="progress" class="hidden">
<h2>üìä Your Progress</h2>
<div class="grid">
<div class="card">
<div class="head"><h3>Mastery by Topic</h3></div>
<div class="body" id="mastery-breakdown"></div>
</div>
<div class="card">
<div class="head"><h3>Recent Activity</h3></div>
<div class="body" id="activity-log"></div>
</div>
</div>
</section>

<section id="commands" class="hidden">
<h2>üßæ Interactive Command Reference</h2>
<div class="card">
<div class="head">
<h3>Test 2 Commands - Click to Practice!</h3>
<div class="flex">
<input type="text" id="cmd-search" class="command-input" placeholder="üîç Search commands..." style="width:300px">
<select id="cmd-filter" class="btn">
<option value="all">All Topics</option>
<option value="NAT">NAT</option>
<option value="EIGRP">EIGRP</option>
<option value="OSPF">OSPF</option>
<option value="IPv6">IPv6</option>
<option value="L3">L3 Switch</option>
<option value="Frame Relay">Frame Relay</option>
<option value="Verify">Verify</option>
</select>
</div>
</div>
<div class="body">
<div style="overflow-x:auto">
<table id="commands-table">
<thead>
<tr>
<th style="width:30%">Command</th>
<th style="width:20%">Purpose</th>
<th style="width:25%">Example Usage</th>
<th style="width:15%">Topic</th>
<th style="width:10%">Action</th>
</tr>
</thead>
<tbody id="commands-tbody"></tbody>
</table>
</div>
</div>
</div>
</section>
</main>
</div>

<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
<h3 id="popup-title">Success!</h3>
<p id="popup-msg"></p>
<button class="btn primary" id="popup-close">Continue</button>
</div>

<div class="popup cmd-popup" id="cmd-popup">
<h3 id="cmd-popup-title"></h3>
<div id="cmd-popup-content"></div>
<div class="cmd-practice-area" id="cmd-practice">
<div class="muted" style="margin-bottom:8px">Try it yourself:</div>
<input type="text" class="command-input" id="cmd-practice-input" placeholder="Type the command...">
<div id="cmd-practice-feedback" style="margin-top:8px"></div>
</div>
<button class="btn primary" id="cmd-popup-close">Done</button>
</div>

<script>
(function(){
const state={
  theme:'dark',
  progress:{nat:0,tunnel:0,dv:0,frame:0,ipv6:0},
  stats:{total:0,correct:0,streak:0,labs:0},
  currentLab:null,
  currentStep:0
};

// Load/save state
function save(){localStorage.setItem('t2pro_v2',JSON.stringify(state))}
function load(){try{Object.assign(state,JSON.parse(localStorage.getItem('t2pro_v2')||'{}'))}catch{}}
load();

// Theme
function setTheme(t){document.documentElement.setAttribute('data-theme',t);state.theme=t;save()}
setTheme(state.theme);
document.getElementById('themeBtn').onclick=()=>setTheme(state.theme==='dark'?'light':'dark');

// Navigation
window.goTo=function(id){
  document.querySelectorAll('main > section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id)?.classList.remove('hidden');
  document.querySelectorAll('.nav a').forEach(a=>a.classList.toggle('active',a.getAttribute('href')==='#'+id));
  if(id==='interactive')loadLab();
  if(id==='scenarios')loadScenario(document.querySelector('.tab-btn.active').dataset.topic);
  if(id==='progress')renderProgress();
};
document.querySelectorAll('.nav a').forEach(a=>a.addEventListener('click',e=>{e.preventDefault();goTo(a.getAttribute('href').slice(1))}));

// Interactive Labs Database
const LABS={
  nat_dynamic:{
    title:'Q1: NAT Dynamic Configuration',
    scenario:'You have a small office with network 10.10.10.0/24 that needs internet access. The ISP has given you public IPs 198.51.100.20-60. Configure Dynamic NAT.',
    topology:`
    [LAN: 10.10.10.0/24] ---- [Router] ---- [Internet]
                              g0/0    g0/1
                             (inside) (outside)
    `,
    steps:[
      {
        prompt:'Step 1: Create the NAT pool named "LANPOOL" with range 198.51.100.20 to 198.51.100.60 and netmask 255.255.255.0',
        hint:'Use: ip nat pool <name> <start-ip> <end-ip> netmask <mask>',
        solution:'ip nat pool LANPOOL 198.51.100.20 198.51.100.60 netmask 255.255.255.0',
        validate:['ip nat pool lanpool','198.51.100.20','198.51.100.60','netmask 255.255.255.0']
      },
      {
        prompt:'Step 2: Create access-list 10 to permit the inside network 10.10.10.0 with wildcard 0.0.0.255',
        hint:'Use: access-list <number> permit <network> <wildcard>',
        solution:'access-list 10 permit 10.10.10.0 0.0.0.255',
        validate:['access-list 10 permit 10.10.10.0','0.0.0.255']
      },
      {
        prompt:'Step 3: Bind access-list 10 to pool LANPOOL',
        hint:'Use: ip nat inside source list <acl> pool <pool-name>',
        solution:'ip nat inside source list 10 pool LANPOOL',
        validate:['ip nat inside source list 10 pool lanpool']
      },
      {
        prompt:'Step 4: Mark interface g0/0 as inside',
        hint:'Enter interface config mode first, then use: ip nat inside',
        solution:'int g0/0\n ip nat inside',
        validate:['int g0/0','ip nat inside']
      },
      {
        prompt:'Step 5: Mark interface g0/1 as outside',
        hint:'Enter interface config mode first, then use: ip nat outside',
        solution:'int g0/1\n ip nat outside',
        validate:['int g0/1','ip nat outside']
      }
    ]
  },
  tunnel_gre:{
    title:'Q2: GRE Tunnel Configuration',
    scenario:'Create a GRE tunnel between Router0 (10.1.1.1) and Router1 (10.1.1.2) with tunnel IPs 172.16.0.1 and 172.16.0.2',
    topology:`
    [Router0] ========= GRE Tunnel ========= [Router1]
    10.1.1.1                                   10.1.1.2
    Tunnel0: 172.16.0.1/30          Tunnel0: 172.16.0.2/30
    `,
    steps:[
      {
        prompt:'Router0 - Step 1: Create tunnel interface 0',
        hint:'Use: interface tunnel 0',
        solution:'interface tunnel 0',
        validate:['interface tunnel 0']
      },
      {
        prompt:'Router0 - Step 2: Set tunnel IP address 172.16.0.1/30',
        hint:'Use: ip address 172.16.0.1 255.255.255.252',
        solution:'ip address 172.16.0.1 255.255.255.252',
        validate:['ip address 172.16.0.1 255.255.255.252']
      },
      {
        prompt:'Router0 - Step 3: Set tunnel source to 10.1.1.1',
        hint:'Use: tunnel source <ip>',
        solution:'tunnel source 10.1.1.1',
        validate:['tunnel source 10.1.1.1']
      },
      {
        prompt:'Router0 - Step 4: Set tunnel destination to 10.1.1.2',
        hint:'Use: tunnel destination <ip>',
        solution:'tunnel destination 10.1.1.2',
        validate:['tunnel destination 10.1.1.2']
      },
      {
        prompt:'Router0 - Step 5: Bring tunnel up with no shutdown',
        hint:'Use: no shutdown (or no shut)',
        solution:'no shutdown',
        validate:['no shut']
      }
    ]
  },
  frame_relay:{
    title:'Q4: Frame Relay Sub-interfaces',
    scenario:'Configure Frame Relay on R0 with 3 point-to-point sub-interfaces to 3 spoke routers. Use DLCIs 101, 102, 103.',
    topology:`
          R1 (10.10.1.0/24)
         /  DLCI 101
       R0 -- R2 (10.10.2.0/24) DLCI 102
         \\
          R3 (10.10.3.0/24) DLCI 103
    `,
    steps:[
      {
        prompt:'Step 1: Enable Frame Relay encapsulation on physical interface s0/0/0',
        hint:'Use: int s0/0/0 then encapsulation frame-relay',
        solution:'int s0/0/0\n encapsulation frame-relay',
        validate:['int s0/0/0','encapsulation frame-relay']
      },
      {
        prompt:'Step 2: Create subinterface s0/0/0.1 point-to-point with IP 172.16.1.1/30',
        hint:'Use: int s0/0/0.1 point-to-point, then ip address',
        solution:'int s0/0/0.1 point-to-point\n ip address 172.16.1.1 255.255.255.252',
        validate:['int s0/0/0.1 point-to-point','ip address 172.16.1.1']
      },
      {
        prompt:'Step 3: Bind DLCI 101 to subinterface .1',
        hint:'Use: frame-relay interface-dlci 101',
        solution:'frame-relay interface-dlci 101',
        validate:['frame-relay interface-dlci 101']
      },
      {
        prompt:'Step 4: Create subinterface s0/0/0.2 point-to-point with IP 172.16.2.1/30 and DLCI 102',
        hint:'Same pattern as .1 but with .2, different IP and DLCI',
        solution:'int s0/0/0.2 point-to-point\n ip address 172.16.2.1 255.255.255.252\n frame-relay interface-dlci 102',
        validate:['int s0/0/0.2 point-to-point','172.16.2.1','dlci 102']
      },
      {
        prompt:'Step 5: Add static route to spoke network 10.10.1.0/24 via 172.16.1.2',
        hint:'Use: ip route <destination> <mask> <next-hop>',
        solution:'ip route 10.10.1.0 255.255.255.0 172.16.1.2',
        validate:['ip route 10.10.1.0 255.255.255.0 172.16.1.2']
      }
    ]
  },
  ipv6_ospf:{
    title:'Q5: IPv6 OSPF Configuration',
    scenario:'Configure OSPFv3 on a router with process ID 10, router-id 1.1.1.1, and enable on interfaces f0/0 and s0/0/0 in area 0',
    topology:`
    [f0/0: 2001:db8:1::1/64] ---- Router ---- [s0/0/0: 2001:db8:10:12::1/64]
                              OSPFv3 Process 10
                              RID: 1.1.1.1
                              Area 0
    `,
    steps:[
      {
        prompt:'Step 1: Enable IPv6 routing globally',
        hint:'Use: ipv6 unicast-routing',
        solution:'ipv6 unicast-routing',
        validate:['ipv6 unicast-routing']
      },
      {
        prompt:'Step 2: Create OSPFv3 process 10',
        hint:'Use: ipv6 router ospf 10',
        solution:'ipv6 router ospf 10',
        validate:['ipv6 router ospf 10']
      },
      {
        prompt:'Step 3: Set router-id to 1.1.1.1',
        hint:'Use: router-id 1.1.1.1',
        solution:'router-id 1.1.1.1',
        validate:['router-id 1.1.1.1']
      },
      {
        prompt:'Step 4: Configure f0/0 with IPv6 address 2001:db8:1::1/64 and enable OSPF area 0',
        hint:'int f0/0, ipv6 address, ipv6 ospf 10 area 0',
        solution:'int f0/0\n ipv6 address 2001:db8:1::1/64\n ipv6 ospf 10 area 0',
        validate:['int f0/0','ipv6 address 2001:db8:1::1/64','ipv6 ospf 10 area 0']
      },
      {
        prompt:'Step 5: Configure s0/0/0 with IPv6 address 2001:db8:10:12::1/64 and enable OSPF area 0',
        hint:'Same pattern as f0/0 but different interface and address',
        solution:'int s0/0/0\n ipv6 address 2001:db8:10:12::1/64\n ipv6 ospf 10 area 0',
        validate:['int s0/0/0','ipv6 address 2001:db8:10:12::1/64','ipv6 ospf 10 area 0']
      }
    ]
  },
  dv_routing:{
    title:'Q3: Distance Vector Routing - Round 1',
    scenario:'Calculate the routing tables after Round 1 of Distance Vector routing for the given topology',
    topology:`
         [R1] -- 5 -- [R2]
          |            |
          3            2
          |            |
         [R3] -- 4 -- [R4]
    `,
    steps:[
      {
        prompt:'Round 1: What routes does R1 learn from its directly connected neighbors?',
        hint:'R1 is connected to R2 (cost 5) and R3 (cost 3). It learns their directly connected networks.',
        solution:'R1 learns: R2 (cost 5), R3 (cost 3)',
        validate:['r2','cost 5','r3','cost 3']
      },
      {
        prompt:'What is R1\'s routing table after Round 1?',
        hint:'R1 directly knows R2(5) and R3(3). Through R2, it can reach R4(5+2=7). Through R3, it can reach R4(3+4=7).',
        solution:'R1: R2(5), R3(3), R4(7)',
        validate:['r2','r3','r4','7']
      },
      {
        prompt:'What routes does R2 advertise to R1 in Round 1?',
        hint:'R2 advertises its directly connected networks: R1(5) and R4(2)',
        solution:'R2 advertises: R1(5), R4(2)',
        validate:['r1','r4','2']
      },
      {
        prompt:'After Round 1, which router has the best path from R1 to R4?',
        hint:'Compare costs: R1->R2->R4 = 5+2=7, R1->R3->R4 = 3+4=7. They tie!',
        solution:'Both paths tie at cost 7',
        validate:['7','tie']
      },
      {
        prompt:'Complete: After Round 1, R3 knows about which routers and at what cost?',
        hint:'R3 connects to R1(3) and R4(4). Through R1, learns R2(3+5=8). Through R4, learns R2(4+2=6).',
        solution:'R3: R1(3), R4(4), R2(6)',
        validate:['r1','3','r4','4','r2','6']
      }
    ]
  }
};

// Lab loading and management
let currentLabSteps=[];
let currentStepIndex=0;

function loadLab(labId){
  if(!labId){
    const keys=Object.keys(LABS);
    labId=keys[Math.floor(Math.random()*keys.length)];
  }
  
  const lab=LABS[labId];
  state.currentLab=labId;
  currentLabSteps=lab.steps;
  currentStepIndex=0;
  
  document.getElementById('lab-title').textContent=lab.title;
  document.getElementById('scenario-desc').innerHTML=`<h4>Scenario</h4><p>${lab.scenario}</p>`;
  document.getElementById('topology-view').innerHTML=lab.topology;
  
  renderSteps();
  updateProgress();
}

function renderSteps(){
  const container=document.getElementById('steps-container');
  container.innerHTML='';
  
  currentLabSteps.forEach((step,idx)=>{
    const div=document.createElement('div');
    div.className='challenge-step';
    if(idx<currentStepIndex)div.classList.add('completed');
    if(idx===currentStepIndex)div.classList.add('active');
    
    div.innerHTML=`
      <div class="step-number">${idx+1}/${currentLabSteps.length}</div>
      <div><strong>${step.prompt}</strong></div>
      ${idx===currentStepIndex?`
        <input type="text" class="command-input" id="step-input-${idx}" placeholder="Type your command here..." ${idx!==currentStepIndex?'disabled':''}>
        <div id="validation-${idx}"></div>
      `:''}
      ${idx<currentStepIndex?'<div class="ok">‚úÖ Completed</div>':''}
    `;
    container.appendChild(div);
  });
  
  const input=document.getElementById(`step-input-${currentStepIndex}`);
  if(input){
    input.focus();
    input.addEventListener('keydown',e=>{
      if(e.key==='Enter'){
        validateStep(currentStepIndex,input.value);
      }
    });
  }
  
  document.getElementById('step-counter').textContent=`${currentStepIndex+1}/${currentLabSteps.length}`;
}

function validateStep(stepIdx,answer){
  const step=currentLabSteps[stepIdx];
  const normalized=answer.toLowerCase().replace(/\s+/g,' ').trim();
  
  const results=step.validate.map(check=>{
    const checkNorm=check.toLowerCase();
    return {text:check,pass:normalized.includes(checkNorm)};
  });
  
  const allPass=results.every(r=>r.pass);
  const valContainer=document.getElementById(`validation-${stepIdx}`);
  
  valContainer.innerHTML=results.map(r=>`
    <div class="validation-item">
      <span>${r.pass?'‚úÖ':'‚ùå'}</span>
      <code>${r.text}</code>
    </div>
  `).join('');
  
  if(allPass){
    showTerminal(`‚úÖ Step ${stepIdx+1} completed correctly!`,'success');
    setTimeout(()=>{
      currentStepIndex++;
      state.stats.correct++;
      if(currentStepIndex>=currentLabSteps.length){
        completeLab();
      }else{
        renderSteps();
      }
      updateProgress();
      save();
    },800);
  }else{
    showTerminal(`‚ùå Not quite right. Check the required elements.`,'error');
    state.stats.total++;
    save();
  }
}

function showTerminal(msg,type='output'){
  const term=document.getElementById('terminal-container');
  term.classList.remove('hidden');
  const line=document.createElement('div');
  line.className='terminal-line';
  line.innerHTML=`<span class="terminal-${type}">${msg}</span>`;
  term.appendChild(line);
  term.scrollTop=term.scrollHeight;
}

function completeLab(){
  state.stats.labs++;
  const topic=state.currentLab.split('_')[0];
  state.progress[topic]=(state.progress[topic]||0)+20;
  if(state.progress[topic]>100)state.progress[topic]=100;
  save();
  
  showPopup('Lab Complete! üéâ',`You've mastered ${state.currentLab}. Great job!`);
  updateProgress();
}

function updateProgress(){
  const pct=(currentStepIndex/currentLabSteps.length)*100;
  document.getElementById('lab-progress').style.width=pct+'%';
  
  const totalMastery=Object.values(state.progress).reduce((a,b)=>a+b,0)/Object.keys(state.progress).length;
  document.getElementById('masteryPct').textContent=Math.round(totalMastery)+'%';
  document.getElementById('labsDone').textContent=state.stats.labs;
  document.getElementById('streak').textContent=state.stats.streak;
}

document.getElementById('hint-btn').onclick=()=>{
  const step=currentLabSteps[currentStepIndex];
  if(step)showPopup('üí° Hint',step.hint);
};

document.getElementById('solution-btn').onclick=()=>{
  const step=currentLabSteps[currentStepIndex];
  if(step){
    document.getElementById(`step-input-${currentStepIndex}`).value=step.solution;
    showPopup('üìñ Solution',`Solution filled in. Review it, then press Enter to continue.`);
  }
};

document.getElementById('next-lab-btn').onclick=()=>{
  loadLab();
  document.getElementById('terminal-container').innerHTML='';
  document.getElementById('terminal-container').classList.add('hidden');
};

// Scenarios
const SCENARIOS={
  nat:{
    title:'NAT Configuration Challenge',
    description:'Your company office (192.168.1.0/24) needs internet access. ISP gave you 203.0.113.50-203.0.113.70. Configure Dynamic NAT with proper inside/outside marking.',
    parts:[
      {q:'a) Write the command to create the NAT pool',validate:['ip nat pool','203.0.113.50','203.0.113.70']},
      {q:'b) Write the ACL to permit your internal network',validate:['access-list','192.168.1.0']},
      {q:'c) Write ALL commands to complete the NAT config',validate:['ip nat inside source','ip nat inside','ip nat outside']}
    ]
  },
  tunnel:{
    title:'GRE Tunnel Setup',
    description:'Connect two branch offices: BranchA (Router0: 50.1.1.1) and BranchB (Router1: 50.1.1.2). Create tunnel with IPs 10.255.255.1/30 and 10.255.255.2/30.',
    parts:[
      {q:'a) Configure the tunnel interface on Router0',validate:['interface tunnel','ip address 10.255.255.1']},
      {q:'b) Set the tunnel source and destination on Router0',validate:['tunnel source 50.1.1.1','tunnel destination 50.1.1.2']},
      {q:'c) Complete the config including no shutdown',validate:['no shut']}
    ]
  },
  dv:{
    title:'Distance Vector Round 1 Calculation',
    description:'Given topology: R1--[2]--R2--[3]--R3, R1--[5]--R4--[1]--R3',
    parts:[
      {q:'a) What does R1 learn in Round 1?',validate:['r2','cost 2','r4','cost 5']},
      {q:'b) What is R1\'s best path to R3?',validate:['r2','r3','cost 5']},
      {q:'c) List R2\'s complete routing table after Round 1',validate:['r1','r3','r4']}
    ]
  },
  frame:{
    title:'Frame Relay with Sub-interfaces',
    description:'Hub-and-spoke: R0 (hub) connects to R1 (DLCI 201), R2 (DLCI 202). Use /30 addresses: 10.0.1.0/30 for R1 link, 10.0.2.0/30 for R2 link.',
    parts:[
      {q:'a) Enable Frame Relay on physical interface s0/1/0',validate:['int s0/1/0','encapsulation frame-relay']},
      {q:'b) Configure subinterface .1 for R1 with DLCI 201',validate:['int s0/1/0.1','point-to-point','dlci 201','10.0.1.1']},
      {q:'c) Add static route to R1\'s LAN (172.20.1.0/24)',validate:['ip route 172.20.1.0 255.255.255.0']}
    ]
  },
  ipv6:{
    title:'IPv6 OSPF Deployment',
    description:'Configure OSPFv3 process 50 on Router with RID 5.5.5.5. Interface g0/0 has 2001:db8:a::1/64 and g0/1 has 2001:db8:b::1/64, both in area 10.',
    parts:[
      {q:'a) Enable IPv6 and create OSPF process with RID',validate:['ipv6 unicast-routing','ipv6 router ospf 50','router-id 5.5.5.5']},
      {q:'b) Configure g0/0 with IPv6 and OSPF',validate:['int g0/0','ipv6 address 2001:db8:a::1/64','ipv6 ospf 50 area 10']},
      {q:'c) Configure g0/1 with IPv6 and OSPF',validate:['int g0/1','ipv6 address 2001:db8:b::1/64','ipv6 ospf 50 area 10']}
    ]
  }
};

function loadScenario(topic){
  const scenario=SCENARIOS[topic];
  const container=document.getElementById('scenario-content');
  
  container.innerHTML=`
    <div class="card">
      <div class="head"><h3>${scenario.title}</h3></div>
      <div class="body">
        <div class="scenario-box">
          <h4>Scenario</h4>
          <p>${scenario.description}</p>
        </div>
        ${scenario.parts.map((part,idx)=>`
          <div class="sub-question">
            <strong>${part.q}</strong>
            <textarea class="command-input" id="scenario-${topic}-${idx}" rows="3" placeholder="Write your command(s) here..."></textarea>
            <div id="feedback-${topic}-${idx}" class="muted"></div>
          </div>
        `).join('')}
        <button class="btn primary" onclick="checkScenario('${topic}')">Check All Parts</button>
      </div>
    </div>
  `;
}

window.checkScenario=function(topic){
  const scenario=SCENARIOS[topic];
  let allCorrect=true;
  
  scenario.parts.forEach((part,idx)=>{
    const input=document.getElementById(`scenario-${topic}-${idx}`).value.toLowerCase();
    const results=part.validate.map(v=>({check:v,pass:input.includes(v.toLowerCase())}));
    const correct=results.every(r=>r.pass);
    
    const feedback=document.getElementById(`feedback-${topic}-${idx}`);
    if(correct){
      feedback.innerHTML='<span class="ok">‚úÖ Correct!</span>';
    }else{
      const missing=results.filter(r=>!r.pass).map(r=>r.check).join(', ');
      feedback.innerHTML=`<span class="err">‚ùå Missing: ${missing}</span>`;
      allCorrect=false;
    }
  });
  
  if(allCorrect){
    state.progress[topic]=(state.progress[topic]||0)+15;
    if(state.progress[topic]>100)state.progress[topic]=100;
    save();
    showPopup('Scenario Complete! üéØ',`All parts correct! ${topic} mastery increased.`);
  }
};

document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    loadScenario(btn.dataset.topic);
  });
});

// Exam Simulator
const EXAM_QUESTIONS=[
  {
    title:'Question 1: NAT Dynamic (10 marks)',
    parts:[
      {text:'a) Configure NAT pool "OFFICE" from 200.1.1.10 to 200.1.1.30, netmask 255.255.255.0',validate:['ip nat pool office','200.1.1.10','200.1.1.30','netmask']},
      {text:'b) Create ACL 15 to permit internal subnet 172.30.0.0/16',validate:['access-list 15 permit 172.30.0.0','0.0.255.255']},
      {text:'c) Complete NAT config with inside/outside on g0/0 (LAN) and g0/1 (WAN)',validate:['ip nat inside source list 15 pool office','int g0/0','ip nat inside','int g0/1','ip nat outside']}
    ]
  },
  {
    title:'Question 2: GRE Tunnel (20 marks)',
    parts:[
      {text:'a) On Router0, create tunnel 1 with IP 192.168.100.1/30',validate:['interface tunnel 1','ip address 192.168.100.1 255.255.255.252']},
      {text:'b) Set tunnel source to 88.88.1.1 and destination to 88.88.2.2',validate:['tunnel source 88.88.1.1','tunnel destination 88.88.2.2']},
      {text:'c) Bring up the tunnel and verify with show commands',validate:['no shut','show']}
    ]
  },
  {
    title:'Question 3: Distance Vector Round 1 (10 marks)',
    parts:[
      {text:'a) Given R1-[4]-R2-[2]-R3 and R1-[8]-R4-[3]-R3, what does R1 learn from neighbors?',validate:['r2','4','r4','8']},
      {text:'b) What is R1\'s routing table after round 1?',validate:['r2','r3','r4']},
      {text:'c) Best path from R1 to R3?',validate:['r2','r3','6']}
    ]
  },
  {
    title:'Question 4: Frame Relay Sub-interfaces (30 marks)',
    parts:[
      {text:'a) Enable Frame Relay on s0/0/1',validate:['int s0/0/1','encapsulation frame-relay']},
      {text:'b) Configure subinterface .5 point-to-point with IP 10.50.5.1/30 and DLCI 301',validate:['int s0/0/1.5 point-to-point','ip address 10.50.5.1 255.255.255.252','frame-relay interface-dlci 301']},
      {text:'c) Add static route to spoke network 192.168.50.0/24 via 10.50.5.2',validate:['ip route 192.168.50.0 255.255.255.0 10.50.5.2']}
    ]
  },
  {
    title:'Question 5: IPv6 OSPF (30 marks)',
    parts:[
      {text:'a) Enable IPv6 routing and create OSPFv3 process 100 with RID 10.10.10.10',validate:['ipv6 unicast-routing','ipv6 router ospf 100','router-id 10.10.10.10']},
      {text:'b) Configure f0/1 with 2001:db8:cafe::1/64 and enable OSPF area 0',validate:['int f0/1','ipv6 address 2001:db8:cafe::1/64','ipv6 ospf 100 area 0']},
      {text:'c) Configure s0/1/0 with 2001:db8:feed::1/64 and enable OSPF area 5',validate:['int s0/1/0','ipv6 address 2001:db8:feed::1/64','ipv6 ospf 100 area 5']}
    ]
  }
];

let examTimer=null;
let examSeconds=45*60;

function startExam(){
  examSeconds=45*60;
  document.getElementById('start-exam-btn').disabled=true;
  document.getElementById('submit-exam-btn').disabled=false;
  
  const container=document.getElementById('exam-container');
  container.innerHTML=EXAM_QUESTIONS.map((q,qIdx)=>`
    <div class="exam-question">
      <h4>${q.title}</h4>
      ${q.parts.map((part,pIdx)=>`
        <div class="sub-question">
          <div><strong>${part.text}</strong></div>
          <textarea class="command-input" id="exam-q${qIdx}-p${pIdx}" rows="4"></textarea>
        </div>
      `).join('')}
    </div>
  `).join('');
  
  examTimer=setInterval(()=>{
    examSeconds--;
    const m=Math.floor(examSeconds/60);
    const s=examSeconds%60;
    document.getElementById('exam-timer').textContent=`${m}:${s<10?'0':''}${s}`;
    if(examSeconds<=0){
      clearInterval(examTimer);
      submitExam(true);
    }
  },1000);
}

function submitExam(auto){
  clearInterval(examTimer);
  let totalParts=0;
  let correctParts=0;
  
  EXAM_QUESTIONS.forEach((q,qIdx)=>{
    q.parts.forEach((part,pIdx)=>{
      totalParts++;
      const answer=document.getElementById(`exam-q${qIdx}-p${pIdx}`).value.toLowerCase();
      const allValid=part.validate.every(v=>answer.includes(v.toLowerCase()));
      if(allValid)correctParts++;
    });
  });
  
  const score=Math.round((correctParts/totalParts)*100);
  const grade=score>=80?'üéâ PASS':score>=60?'‚ö†Ô∏è NEEDS WORK':'‚ùå FAIL';
  
  showPopup(`Exam ${auto?'Time Up':'Submitted'}!`,`Score: ${score}% (${correctParts}/${totalParts} parts correct)\n${grade}`);
  
  document.getElementById('submit-exam-btn').disabled=true;
  state.stats.total+=totalParts;
  state.stats.correct+=correctParts;
  save();
}

document.getElementById('start-exam-btn').onclick=startExam;
document.getElementById('submit-exam-btn').onclick=()=>submitExam(false);

// Quick Drills
const DRILL_BANK=[
  {q:'Wildcard for /28?',a:['0.0.0.15']},
  {q:'Command to show NAT translations?',a:['show ip nat translations']},
  {q:'EIGRP AD value?',a:['90']},
  {q:'Command to set bandwidth on interface?',a:['bandwidth']},
  {q:'Enable IPv6 routing?',a:['ipv6 unicast-routing']},
  {q:'OSPFv3 command to set router-id?',a:['router-id']},
  {q:'Frame Relay encapsulation command?',a:['encapsulation frame-relay']},
  {q:'Create tunnel interface 0?',a:['interface tunnel 0']},
  {q:'Mark interface as NAT inside?',a:['ip nat inside']},
  {q:'OSPF wildcard for /30?',a:['0.0.0.3']}
];

let drillTimer=null;
let drillSeconds=0;
let drillIdx=0;
let drillScore={correct:0,total:0};

function startDrill(){
  drillSeconds=0;
  drillIdx=0;
  drillScore={correct:0,total:0};
  document.getElementById('drill-question').classList.remove('hidden');
  document.getElementById('drill-input').value='';
  document.getElementById('drill-input').disabled=false;
  nextDrill();
  
  drillTimer=setInterval(()=>{
    drillSeconds++;
    const m=Math.floor(drillSeconds/60);
    const s=drillSeconds%60;
    document.getElementById('drill-timer').textContent=`${m<10?'0':''}${m}:${s<10?'0':''}${s}`;
  },1000);
}

function nextDrill(){
  if(drillIdx>=DRILL_BANK.length){
    clearInterval(drillTimer);
    showPopup('Drill Complete!',`Score: ${drillScore.correct}/${drillScore.total}\nTime: ${Math.floor(drillSeconds/60)}:${drillSeconds%60}`);
    return;
  }
  
  const drill=DRILL_BANK[drillIdx];
  document.getElementById('drill-question').innerHTML=`<strong>Q${drillIdx+1}:</strong> ${drill.q}`;
  document.getElementById('drill-feedback').textContent='';
}

function checkDrill(answer){
  const drill=DRILL_BANK[drillIdx];
  const correct=drill.a.some(a=>answer.toLowerCase().includes(a.toLowerCase()));
  
  drillScore.total++;
  if(correct)drillScore.correct++;
  
  const fb=document.getElementById('drill-feedback');
  fb.innerHTML=correct?'<span class="ok">‚úÖ Correct!</span>':`<span class="err">‚ùå Answer: ${drill.a[0]}</span>`;
  
  document.getElementById('drill-score').textContent=`${drillScore.correct}/${drillScore.total}`;
  
  const history=document.getElementById('drill-history');
  const entry=document.createElement('div');
  entry.innerHTML=`${correct?'‚úÖ':'‚ùå'} ${drill.q} - ${answer}`;
  entry.style.padding='4px 8px';
  entry.style.background='var(--glass)';
  entry.style.borderRadius='6px';
  entry.style.marginTop='4px';
  history.prepend(entry);
  
  setTimeout(()=>{
    drillIdx++;
    document.getElementById('drill-input').value='';
    nextDrill();
  },1000);
}

document.getElementById('start-drill-btn').onclick=startDrill;
document.getElementById('drill-input').addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    checkDrill(e.target.value);
  }
});

// Progress
function renderProgress(){
  const mastery=document.getElementById('mastery-breakdown');
  mastery.innerHTML=Object.keys(state.progress).map(topic=>`
    <div style="margin:12px 0">
      <div style="display:flex;justify-content:space-between">
        <span>${topic.toUpperCase()}</span>
        <span>${state.progress[topic]||0}%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width:${state.progress[topic]||0}%"></div>
      </div>
    </div>
  `).join('');
  
  const activity=document.getElementById('activity-log');
  activity.innerHTML=`
    <div>Total Questions: ${state.stats.total}</div>
    <div>Correct: ${state.stats.correct}</div>
    <div>Labs Completed: ${state.stats.labs}</div>
    <div>Current Streak: ${state.stats.streak}</div>
  `;
}

// Popup
function showPopup(title,msg){
  document.getElementById('popup-title').textContent=title;
  document.getElementById('popup-msg').textContent=msg;
  document.getElementById('popup').classList.add('show');
  document.getElementById('overlay').classList.add('show');
}

document.getElementById('popup-close').onclick=()=>{
  document.getElementById('popup').classList.remove('show');
  document.getElementById('overlay').classList.remove('show');
};

// Initialize
goTo('dash');
updateProgress();

// Commands Reference Table
const COMMANDS_DATA=[
  {cmd:'ip nat inside source static <in> <out>',purpose:'One-to-one static NAT',example:'ip nat inside source static 10.10.10.50 198.51.100.50',topic:'NAT',template:'Map host <inside-ip> to public <global-ip>'},
  {cmd:'ip nat pool <name> <start> <end> netmask <mask>',purpose:'Create dynamic NAT pool',example:'ip nat pool LANPOOL 198.51.100.20 198.51.100.60 netmask 255.255.255.0',topic:'NAT',template:'Create pool from <start> to <end>'},
  {cmd:'access-list 10 permit <net> <wc>',purpose:'Match inside subnet for NAT',example:'access-list 10 permit 10.10.10.0 0.0.0.255',topic:'NAT',template:'Permit subnet <net> <wildcard>'},
  {cmd:'ip nat inside source list 10 pool <name>',purpose:'Bind ACL to pool',example:'ip nat inside source list 10 pool LANPOOL',topic:'NAT',template:'Bind ACL to pool for translation'},
  {cmd:'ip nat inside',purpose:'Mark LAN interface',example:'int g0/0 ‚Üí ip nat inside',topic:'NAT',template:'Mark <interface> as inside'},
  {cmd:'ip nat outside',purpose:'Mark WAN interface',example:'int g0/1 ‚Üí ip nat outside',topic:'NAT',template:'Mark <interface> as outside'},
  {cmd:'ip nat inside source list 1 interface g0/1 overload',purpose:'PAT via interface',example:'ip nat inside source list 1 interface g0/1 overload',topic:'NAT',template:'Configure PAT with overload'},
  
  {cmd:'router eigrp <asn>',purpose:'Start EIGRP',example:'router eigrp 20',topic:'EIGRP',template:'Start EIGRP AS <number>'},
  {cmd:'network <ip>',purpose:'Advertise network',example:'network 10.1.1.0',topic:'EIGRP',template:'Advertise <network> in EIGRP'},
  {cmd:'bandwidth <kbit>',purpose:'Set interface bandwidth',example:'int s0/0/0 ‚Üí bandwidth 1024',topic:'EIGRP',template:'Set bandwidth to influence metric'},
  
  {cmd:'router ospf <pid>',purpose:'Start OSPFv2',example:'router ospf 101',topic:'OSPF',template:'Start OSPF process <pid>'},
  {cmd:'network <ip> <wc> area <id>',purpose:'Place interface in area',example:'network 10.1.2.0 0.0.0.3 area 101',topic:'OSPF',template:'Put network in Area <id>'},
  {cmd:'no network <ip> <wc> area <id>',purpose:'Remove from area',example:'no network 192.168.10.8 0.0.0.3 area 101',topic:'OSPF',template:'Move network between areas'},
  
  {cmd:'ipv6 unicast-routing',purpose:'Enable IPv6 routing',example:'ipv6 unicast-routing',topic:'IPv6',template:'Enable IPv6 forwarding'},
  {cmd:'ipv6 router ospf <pid>',purpose:'Start OSPFv3',example:'ipv6 router ospf 10',topic:'IPv6',template:'Create OSPFv3 process'},
  {cmd:'router-id <A.B.C.D>',purpose:'Set OSPFv3 router-id',example:'router-id 1.1.1.1',topic:'IPv6',template:'Assign router-id'},
  {cmd:'ipv6 address <addr>/<prefix>',purpose:'Assign IPv6 address',example:'int f0/0 ‚Üí ipv6 address 2001:db8:1::1/64',topic:'IPv6',template:'Set IPv6 on interface'},
  {cmd:'ipv6 ospf <pid> area <id>',purpose:'Enable OSPFv3 on interface',example:'int f0/0 ‚Üí ipv6 ospf 10 area 0',topic:'IPv6',template:'Enable OSPFv3 in Area'},
  
  {cmd:'no switchport',purpose:'Make routed port on L3 switch',example:'int f0/3 ‚Üí no switchport',topic:'L3',template:'Convert to routed port'},
  {cmd:'ip address <ip> <mask>',purpose:'Set IPv4 on interface',example:'int f0/3 ‚Üí ip address 192.168.1.2 255.255.255.0',topic:'L3',template:'Assign IPv4 address'},
  {cmd:'no shutdown',purpose:'Enable interface',example:'int f0/1 ‚Üí no shut',topic:'L3',template:'Bring interface up'},
  {cmd:'ip route 0.0.0.0 0.0.0.0 <next-hop>',purpose:'Default route',example:'ip route 0.0.0.0 0.0.0.0 192.168.1.1',topic:'L3',template:'Set default gateway'},
  
  {cmd:'encapsulation frame-relay',purpose:'Enable Frame Relay',example:'int s0/0/0 ‚Üí encapsulation frame-relay',topic:'Frame Relay',template:'Enable FR on serial'},
  {cmd:'interface s0/0/0.X point-to-point',purpose:'Create p2p subinterface',example:'int s0/0/0.1 point-to-point',topic:'Frame Relay',template:'Create subinterface'},
  {cmd:'frame-relay interface-dlci <id>',purpose:'Bind DLCI on subif',example:'frame-relay interface-dlci 101',topic:'Frame Relay',template:'Bind DLCI to subif'},
  {cmd:'ip route <net> <mask> <next-hop>',purpose:'Static to spokes',example:'ip route 10.10.1.0 255.255.255.0 172.16.1.2',topic:'Frame Relay',template:'Add static route'},
  
  {cmd:'show ip nat translations',purpose:'View NAT table',example:'show ip nat translations',topic:'Verify',template:'Show current NAT mappings'},
  {cmd:'show ip nat statistics',purpose:'NAT counters',example:'show ip nat statistics',topic:'Verify',template:'Show NAT hit counts'},
  {cmd:'show ip eigrp neighbors',purpose:'EIGRP adjacencies',example:'show ip eigrp neighbors',topic:'Verify',template:'List EIGRP neighbors'},
  {cmd:'show ip eigrp topology',purpose:'EIGRP topology',example:'show ip eigrp topology',topic:'Verify',template:'Show successors/FS'},
  {cmd:'show ip ospf neighbor',purpose:'OSPFv2 neighbors',example:'show ip ospf neighbor',topic:'Verify',template:'List OSPF neighbors'},
  {cmd:'show ip ospf interface',purpose:'OSPFv2 interfaces',example:'show ip ospf interface',topic:'Verify',template:'Show OSPF cost/type'},
  {cmd:'show ipv6 ospf neighbor',purpose:'OSPFv3 neighbors',example:'show ipv6 ospf neighbor',topic:'Verify',template:'Show OSPFv3 adjacencies'},
  {cmd:'show ipv6 route',purpose:'IPv6 routing table',example:'show ipv6 route',topic:'Verify',template:'Display IPv6 RIB'}
];

let filteredCommands=[...COMMANDS_DATA];

function renderCommandsTable(){
  const tbody=document.getElementById('commands-tbody');
  if(!tbody)return;
  
  tbody.innerHTML=filteredCommands.map((c,idx)=>`
    <tr onclick="openCmdPractice(${idx})">
      <td><code>${c.cmd}</code></td>
      <td>${c.purpose}</td>
      <td><code style="font-size:11px">${c.example}</code></td>
      <td><span class="badge">${c.topic}</span></td>
      <td><button class="practice-btn" onclick="event.stopPropagation();openCmdPractice(${idx})">Practice</button></td>
    </tr>
  `).join('');
}

function filterCommands(){
  const search=document.getElementById('cmd-search')?.value.toLowerCase()||'';
  const filter=document.getElementById('cmd-filter')?.value||'all';
  
  filteredCommands=COMMANDS_DATA.filter(c=>{
    const matchSearch=!search||c.cmd.toLowerCase().includes(search)||c.purpose.toLowerCase().includes(search)||c.example.toLowerCase().includes(search);
    const matchFilter=filter==='all'||c.topic===filter;
    return matchSearch&&matchFilter;
  });
  
  renderCommandsTable();
}

window.openCmdPractice=function(idx){
  const cmd=filteredCommands[idx];
  document.getElementById('cmd-popup-title').textContent=cmd.purpose;
  document.getElementById('cmd-popup-content').innerHTML=`
    <div style="background:var(--glass);padding:12px;border-radius:8px;margin:12px 0">
      <div class="muted">Command:</div>
      <code style="display:block;margin:8px 0;padding:8px;background:var(--code);border-radius:6px">${cmd.cmd}</code>
      <div class="muted" style="margin-top:12px">Example:</div>
      <code style="display:block;margin:8px 0;padding:8px;background:var(--code);border-radius:6px">${cmd.example}</code>
      <div class="muted" style="margin-top:12px">What to do:</div>
      <div>${cmd.template}</div>
    </div>
  `;
  
  document.getElementById('cmd-practice-input').value='';
  document.getElementById('cmd-practice-input').dataset.answer=cmd.cmd.toLowerCase().replace(/<[^>]+>/g,'').trim();
  document.getElementById('cmd-practice-feedback').innerHTML='';
  
  document.getElementById('cmd-popup').classList.add('show');
  document.getElementById('overlay').classList.add('show');
  document.getElementById('cmd-practice-input').focus();
};

document.getElementById('cmd-practice-input')?.addEventListener('keydown',function(e){
  if(e.key==='Enter'){
    const input=this.value.toLowerCase().trim();
    const answer=this.dataset.answer;
    
    // Extract key parts of the command for validation
    const keyParts=answer.split(' ').filter(p=>!['<','>'].some(c=>p.includes(c)));
    const hasAllParts=keyParts.every(part=>input.includes(part));
    
    const feedback=document.getElementById('cmd-practice-feedback');
    if(hasAllParts){
      feedback.innerHTML='<span class="ok">‚úÖ Correct! Command structure matches!</span>';
      state.progress[filteredCommands.find(c=>c.cmd.toLowerCase().includes(answer.split(' ')[0]))?.topic.toLowerCase().replace(' relay','').replace('l3','nat')||'nat']=(state.progress[filteredCommands.find(c=>c.cmd.toLowerCase().includes(answer.split(' ')[0]))?.topic.toLowerCase().replace(' relay','').replace('l3','nat')||'nat']||0)+2;
      if(state.progress[filteredCommands.find(c=>c.cmd.toLowerCase().includes(answer.split(' ')[0]))?.topic.toLowerCase().replace(' relay','').replace('l3','nat')||'nat']>100)state.progress[filteredCommands.find(c=>c.cmd.toLowerCase().includes(answer.split(' ')[0]))?.topic.toLowerCase().replace(' relay','').replace('l3','nat')||'nat']=100;
      save();
    }else{
      const missing=keyParts.filter(p=>!input.includes(p));
      feedback.innerHTML=`<span class="err">‚ùå Missing: ${missing.join(', ')}</span>`;
    }
  }
});

document.getElementById('cmd-popup-close')?.addEventListener('click',()=>{
  document.getElementById('cmd-popup').classList.remove('show');
  document.getElementById('overlay').classList.remove('show');
});

document.getElementById('cmd-search')?.addEventListener('input',filterCommands);
document.getElementById('cmd-filter')?.addEventListener('change',filterCommands);

// Render table on page load
setTimeout(()=>{
  if(document.getElementById('commands-tbody')){
    renderCommandsTable();
  }
},100);

})();
</script>
</body>
</html>
